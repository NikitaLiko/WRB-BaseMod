# Улучшения системы команд WRB-BaseMod

## Обзор изменений

Система команд `/wrb rank up/down` была значительно улучшена для повышения удобства использования и локализации.

## Ключевые улучшения

### 1. Русская локализация автодополнения рангов

**До:**
- Автодополнение показывало английские идентификаторы рангов (`private`, `corporal`, etc.)
- И русские названия вместе с английскими, создавая путаницу

**После:**
- Автодополнение показывает **только русские названия** рангов:
  - `Рядовой`
  - `Ефрейтор`
  - `Сержант`
  - `Старший сержант`
  - `Младший лейтенант`
  - `Лейтенант`
  - `Капитан`
  - `Майор`
  - `Подполковник`
  - `Полковник`
  - `Генерал-Майор`
  - `Генерал-Полковник`

### 2. Показ только игроков на сервере

**До:**
- Использовался аргумент `EntityArgument.player()`, который мог показывать недоступных игроков

**После:**
- Автодополнение для параметра `target` показывает **только никнеймы игроков, которые находятся на сервере**
- Добавлена проверка существования игрока на сервере с понятным сообщением об ошибке

### 3. Улучшенная обработка ошибок

- Добавлено сообщение "Игрок {имя} не найден на сервере." если указанный игрок не в сети
- Сохранены все существующие проверки прав доступа и валидации рангов

### 4. Система помощи по командам

**Новое:**
- Добавлена команда `/wrb rank help` для получения справки
- Показывает все доступные команды с описанием
- Выводит полный список всех доступных рангов
- Поддерживает локализацию на русском и английском языках

### 5. Полная локализация сообщений

- Все сообщения об ошибках теперь локализованы
- Поддерживается русский и английский языки
- Используется система Component.translatable() для правильной локализации

## Техническая реализация

### Изменения в `WrbCommands.java`:

1. **Новый провайдер автодополнения для игроков:**
```java
private static final SuggestionProvider<CommandSourceStack> ONLINE_PLAYER_SUGGESTIONS =
        (context, builder) -> {
            List<String> playerNames = context.getSource().getServer().getPlayerList()
                    .getPlayers().stream()
                    .map(player -> player.getName().getString())
                    .toList();
            return SharedSuggestionProvider.suggest(playerNames, builder);
        };
```

2. **Улучшенный провайдер автодополнения для рангов:**
```java
private static final SuggestionProvider<CommandSourceStack> RANK_SUGGESTIONS =
        (context, builder) -> {
            List<String> suggestions = Arrays.stream(WrbRank.values())
                    .map(rank -> rank.getDisplayName().getString())
                    .toList();
            return SharedSuggestionProvider.suggest(suggestions, builder);
        };
```

3. **Новый метод для работы с игроками по имени:**
```java
private static int executeRankChangeByName(CommandContext<CommandSourceStack> ctx, 
                                           String targetName, String rawRank, boolean promotion)
```

4. **Изменена структура команды:**
   - Аргумент `target` теперь использует `StringArgumentType.word()` вместо `EntityArgument.player()`
   - Добавлен новый провайдер предложений `ONLINE_PLAYER_SUGGESTIONS`

## Использование

### Доступные команды:

- `/wrb rank up <ранг>` - повысить себя до указанного ранга
- `/wrb rank up <игрок> <ранг>` - повысить игрока до указанного ранга  
- `/wrb rank down <ранг>` - понизить себя до указанного ранга
- `/wrb rank down <игрок> <ранг>` - понизить игрока до указанного ранга
- **`/wrb rank help`** - показать справку по всем командам и список рангов *(новое!)*

### Примеры:

- `/wrb rank up Сержант`
- `/wrb rank up Player123 Лейтенант`
- `/wrb rank down Рядовой`

## Совместимость

- Все существующие функции сохранены
- Система разрешений не изменена
- Парсинг рангов по русским именам уже был реализован в `WrbRank.fromString()`
- Обратная совместимость с английскими именами рангов сохранена при вводе команд

## Безопасность

- Сохранены все проверки прав доступа через `WrbPermissions`
- Добавлена дополнительная проверка существования игрока на сервере
- Валидация повышения/понижения рангов не изменена

## Результат

Пользователи теперь получают более удобный интерфейс с:
- Русскими названиями рангов в автодополнении
- Показом только доступных игроков
- Понятными сообщениями об ошибках
- Сохранением всех существующих функций безопасности